<!DOCTYPE html>
<html>
<head>
    <title>PlanUR</title>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link href="{{ url_for('static', filename='images/image.jpg') }}">
    <link rel="stylesheet" type = "text/css" href='../static/css/styles.css'>
</head>
<body>
    <div class="main_title">
        <h1></h1>
        <img src="../static/images/ove-removebg-preview (1).png">
    </div>
    <div class="center-text">
        <form action = "{{url_for('predict')}}" method = "post" >
            <h2>Enter city name:</h2>
        <input type="text" name = "location" id="inputbox" >
        <input type ="submit" id="submitbutton">
        </form>
        {% if location %}
        <h3>Map for: {{ location }}</h3>
        <div id="map"></div>
        <script>
            var map = L.map('map').setView([0, 0], 2); // Default to world view
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            fetch(`https://nominatim.openstreetmap.org/search?format=json&q={{ location }}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        var lat = parseFloat(data[0].lat);
                        var lon = parseFloat(data[0].lon);
                        map.setView([lat, lon], 12); // Zoom into location
                        L.marker([lat, lon]).addTo(map)
                            .bindPopup("{{ location }}")
                            .openPopup();
                    } else {
                        alert("Location not found. Try a different name.");
                    }
                })
                .catch(error => {
                    console.error("Error fetching location:", error);
                    alert("Failed to load location. Check console for details.");
                });
        </script>
    {% endif %}
    </div>
</body>
</html>